!function(i){"use strict";var c,u,s="fulfilled",f="undefined",l=function(){var e=[],n=0;function o(){for(;e.length-n;){try{e[n]()}catch(t){i.console&&i.console.error(t)}e[n++]=u,1024==n&&(e.splice(0,1024),n=0)}}var r=function(){if(typeof MutationObserver===f)return typeof process!==f&&"function"==typeof process.nextTick?function(){process.nextTick(o)}:typeof setImmediate!==f?function(){setImmediate(o)}:function(){setTimeout(o,0)};var t=document.createElement("div");return new MutationObserver(o).observe(t,{attributes:!0}),function(){t.setAttribute("a",0)}}();return function(t){e.push(t),e.length-n==1&&r()}}();function a(t){if(t){var e=this;t(function(t){e.resolve(t)},function(t){e.reject(t)})}}function h(e,t){if("function"==typeof e.y)try{var n=e.y.call(u,t);e.p.resolve(n)}catch(t){e.p.reject(t)}else e.p.resolve(t)}function v(e,t){if("function"==typeof e.n)try{var n=e.n.call(u,t);e.p.resolve(n)}catch(t){e.p.reject(t)}else e.p.reject(t)}a.prototype={resolve:function(n){if(this.state===c){if(n===this)return this.reject(new TypeError("Attempt to resolve promise with self"));var o=this;if(n&&("function"==typeof n||"object"==typeof n))try{var e=!0,t=n.then;if("function"==typeof t)return void t.call(n,function(t){e&&(e=!1,o.resolve(t))},function(t){e&&(e=!1,o.reject(t))})}catch(t){return void(e&&this.reject(t))}this.state=s,this.v=n,o.c&&l(function(){for(var t=0,e=o.c.length;t<e;t++)h(o.c[t],n)})}},reject:function(n){if(this.state===c){this.state="rejected",this.v=n;var o=this.c;o?l(function(){for(var t=0,e=o.length;t<e;t++)v(o[t],n)}):!a.suppressUncaughtRejectionError&&i.console&&i.console.log("You upset Zousan. Please catch rejections: ",n,n?n.stack:null)}},then:function(t,e){var n=new a,o={y:t,n:e,p:n};if(this.state===c)this.c?this.c.push(o):this.c=[o];else{var r=this.state,i=this.v;l(function(){r===s?h(o,i):v(o,i)})}return n},catch:function(t){return this.then(null,t)},finally:function(t){return this.then(t,t)},timeout:function(t,o){o=o||"Timeout";var r=this;return new a(function(e,n){setTimeout(function(){n(Error(o))},t),r.then(function(t){e(t)},function(t){n(t)})})}},a.resolve=function(t){var e=new a;return e.resolve(t),e},a.reject=function(t){var e=new a;return e.reject(t),e},a.all=function(n){var o=[],r=0,i=new a;function t(t,e){t&&"function"==typeof t.then||(t=a.resolve(t)),t.then(function(t){o[e]=t,++r==n.length&&i.resolve(o)},function(t){i.reject(t)})}for(var e=0;e<n.length;e++)t(n[e],e);return n.length||i.resolve(o),i},typeof module!=f&&module.exports&&(module.exports=a),i.define&&i.define.amd&&i.define([],function(){return a}),(i.Zousan=a).soon=l}("undefined"!=typeof global?global:this);