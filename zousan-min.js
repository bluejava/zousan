!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).Zousan=t()}(this,function(){"use strict";var e,t="object"==typeof self?self:"object"==typeof window?window:"object"==typeof global?global:this,n=function(){var n=[],o=0,r=1024;function i(){for(;n.length-o;){try{n[o]()}catch(e){t.console&&t.console.error(e)}n[o++]=e,o==r&&(n.splice(0,r),o=0)}}var c=function(){if("undefined"!=typeof MutationObserver){var e=document.createElement("div");return new MutationObserver(i).observe(e,{attributes:!0}),function(){e.setAttribute("a",0)}}return"undefined"!=typeof process&&"function"==typeof process.nextTick?function(){process.nextTick(i)}:"undefined"!=typeof setImmediate?function(){setImmediate(i)}:function(){setTimeout(i,0)}}();return function(e){n.push(e),n.length-o==1&&c()}}();function o(e){if(!(this instanceof o))throw new TypeError("Zousan must be created with the new keyword");if("function"==typeof e){var t=this;try{e(function(e){t.resolve(e)},function(e){t.reject(e)})}catch(e){t.reject(e)}}else if(arguments.length>0)throw new TypeError("Zousan resolver "+e+" is not a function")}function r(t,n){if("function"==typeof t.y)try{var o=t.y.call(e,n);t.p.resolve(o)}catch(e){t.p.reject(e)}else t.p.resolve(n)}function i(t,n){if("function"==typeof t.n)try{var o=t.n.call(e,n);t.p.resolve(o)}catch(e){t.p.reject(e)}else t.p.reject(n)}return o.prototype={resolve:function(e){if(void 0===this.state){if(e===this)return this.reject(new TypeError("Attempt to resolve promise with self"));var t=this;if(e&&("function"==typeof e||"object"==typeof e))try{var o=!0,i=e.then;if("function"==typeof i)return void i.call(e,function(e){o&&(o=!1,t.resolve(e))},function(e){o&&(o=!1,t.reject(e))})}catch(e){return void(o&&this.reject(e))}this.state="fulfilled",this.v=e,t.c&&n(function(){for(var n=0,o=t.c.length;n<o;n++)r(t.c[n],e)})}},reject:function(e){if(void 0===this.state){var r=this;this.state="rejected",this.v=e;var c=this.c;n(c?function(){for(var t=0,n=c.length;t<n;t++)i(c[t],e)}:function(){r.handled||!o.suppressUncaughtRejectionError&&t.console&&o.warn("You upset Zousan. Please catch rejections: ",e,e?e.stack:null)})}},then:function(e,t){var c=new o,f={y:e,n:t,p:c};if(void 0===this.state)this.c?this.c.push(f):this.c=[f];else{var s=this.state,u=this.v;this.handled=!0,n(function(){"fulfilled"===s?r(f,u):i(f,u)})}return c},catch:function(e){return this.then(null,e)},finally:function(e){return this.then(e,e)},timeout:function(e,t){t=t||"Timeout";var n=this;return new o(function(o,r){setTimeout(function(){r(Error(t))},e),n.then(function(e){o(e)},function(e){r(e)})})}},o.resolve=function(e){var t=new o;return t.resolve(e),t},o.reject=function(e){var t=new o;return t.c=[],t.reject(e),t},o.all=function(e){var t=[],n=0,r=new o;function i(i,c){i&&"function"==typeof i.then||(i=o.resolve(i)),i.then(function(o){t[c]=o,++n==e.length&&r.resolve(t)},function(e){r.reject(e)})}for(var c=0;c<e.length;c++)i(e[c],c);return e.length||r.resolve(t),r},o.warn=console.warn,o.soon=n,o});
