!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).Zousan=t()}(this,function(){"use strict";var e,t=function(){var t=[],n=0,o=1024;function r(){for(;t.length-n;){try{t[n]()}catch(e){global.console&&global.console.error(e)}t[n++]=e,n==o&&(t.splice(0,o),n=0)}}var i=function(){if("undefined"!=typeof MutationObserver){var e=document.createElement("div");return new MutationObserver(r).observe(e,{attributes:!0}),function(){e.setAttribute("a",0)}}return"undefined"!=typeof process&&"function"==typeof process.nextTick?function(){process.nextTick(r)}:"undefined"!=typeof setImmediate?function(){setImmediate(r)}:function(){setTimeout(r,0)}}();return function(e){t.push(e),t.length-n==1&&i()}}();function n(e){if(!(this instanceof n))throw new TypeError("Zousan must be created with the new keyword");if("function"==typeof e){var t=this;try{e(function(e){t.resolve(e)},function(e){t.reject(e)})}catch(e){t.reject(e)}}else if(arguments.length>0)throw new TypeError("Zousan resolver "+e+" is not a function")}function o(t,n){if("function"==typeof t.y)try{var o=t.y.call(e,n);t.p.resolve(o)}catch(e){t.p.reject(e)}else t.p.resolve(n)}function r(t,n){if("function"==typeof t.n)try{var o=t.n.call(e,n);t.p.resolve(o)}catch(e){t.p.reject(e)}else t.p.reject(n)}return n.prototype={resolve:function(e){if(void 0===this.state){if(e===this)return this.reject(new TypeError("Attempt to resolve promise with self"));var n=this;if(e&&("function"==typeof e||"object"==typeof e))try{var r=!0,i=e.then;if("function"==typeof i)return void i.call(e,function(e){r&&(r=!1,n.resolve(e))},function(e){r&&(r=!1,n.reject(e))})}catch(e){return void(r&&this.reject(e))}this.state="fulfilled",this.v=e,n.c&&t(function(){for(var t=0,r=n.c.length;t<r;t++)o(n.c[t],e)})}},reject:function(e){if(void 0===this.state){var o=this;this.state="rejected",this.v=e;var i=this.c;t(i?function(){for(var t=0,n=i.length;t<n;t++)r(i[t],e)}:function(){o.handled||!n.suppressUncaughtRejectionError&&global.console&&n.warn("You upset Zousan. Please catch rejections: ",e,e?e.stack:null)})}},then:function(e,i){var c=new n,s={y:e,n:i,p:c};if(void 0===this.state)this.c?this.c.push(s):this.c=[s];else{var f=this.state,u=this.v;this.handled=!0,t(function(){"fulfilled"===f?o(s,u):r(s,u)})}return c},catch:function(e){return this.then(null,e)},finally:function(e){return this.then(e,e)},timeout:function(e,t){t=t||"Timeout";var o=this;return new n(function(n,r){setTimeout(function(){r(Error(t))},e),o.then(function(e){n(e)},function(e){r(e)})})}},n.resolve=function(e){var t=new n;return t.resolve(e),t},n.reject=function(e){var t=new n;return t.c=[],t.reject(e),t},n.all=function(e){var t=[],o=0,r=new n;function i(i,c){i&&"function"==typeof i.then||(i=n.resolve(i)),i.then(function(n){t[c]=n,++o==e.length&&r.resolve(t)},function(e){r.reject(e)})}for(var c=0;c<e.length;c++)i(e[c],c);return e.length||r.resolve(t),r},n.warn=console.warn,n.soon=t,n});
