var STATE_PENDING,_undefined,STATE_FULFILLED="fulfilled",STATE_REJECTED="rejected",_undefinedString="undefined",soon=function(){var e=[],t=0,n=1024;function o(){for(;e.length-t;){try{e[t]()}catch(e){global.console&&global.console.error(e)}e[t++]=_undefined,t==n&&(e.splice(0,n),t=0)}}var r=function(){if(typeof MutationObserver!==_undefinedString){var e=document.createElement("div");return new MutationObserver(o).observe(e,{attributes:!0}),function(){e.setAttribute("a",0)}}return typeof process!==_undefinedString&&"function"==typeof process.nextTick?function(){process.nextTick(o)}:typeof setImmediate!==_undefinedString?function(){setImmediate(o)}:function(){setTimeout(o,0)}}();return function(n){e.push(n),e.length-t==1&&r()}}();function Zousan(e){if(!(this instanceof Zousan))throw new TypeError("Zousan must be created with the new keyword");if("function"==typeof e){var t=this;try{e(function(e){t.resolve(e)},function(e){t.reject(e)})}catch(e){t.reject(e)}}else if(arguments.length>0)throw new TypeError("Zousan resolver "+e+" is not a function")}function resolveClient(e,t){if("function"==typeof e.y)try{var n=e.y.call(_undefined,t);e.p.resolve(n)}catch(t){e.p.reject(t)}else e.p.resolve(t)}function rejectClient(e,t){if("function"==typeof e.n)try{var n=e.n.call(_undefined,t);e.p.resolve(n)}catch(t){e.p.reject(t)}else e.p.reject(t)}Zousan.prototype={resolve:function(e){if(this.state===STATE_PENDING){if(e===this)return this.reject(new TypeError("Attempt to resolve promise with self"));var t=this;if(e&&("function"==typeof e||"object"==typeof e))try{var n=!0,o=e.then;if("function"==typeof o)return void o.call(e,function(e){n&&(n=!1,t.resolve(e))},function(e){n&&(n=!1,t.reject(e))})}catch(e){return void(n&&this.reject(e))}this.state=STATE_FULFILLED,this.v=e,t.c&&soon(function(){for(var n=0,o=t.c.length;n<o;n++)resolveClient(t.c[n],e)})}},reject:function(e){if(this.state===STATE_PENDING){var t=this;this.state=STATE_REJECTED,this.v=e;var n=this.c;soon(n?function(){for(var t=0,o=n.length;t<o;t++)rejectClient(n[t],e)}:function(){t.handled||!Zousan.suppressUncaughtRejectionError&&global.console&&Zousan.warn("You upset Zousan. Please catch rejections: ",e,e?e.stack:null)})}},then:function(e,t){var n=new Zousan,o={y:e,n:t,p:n};if(this.state===STATE_PENDING)this.c?this.c.push(o):this.c=[o];else{var r=this.state,i=this.v;this.handled=!0,soon(function(){r===STATE_FULFILLED?resolveClient(o,i):rejectClient(o,i)})}return n},catch:function(e){return this.then(null,e)},finally:function(e){return this.then(e,e)},timeout:function(e,t){t=t||"Timeout";var n=this;return new Zousan(function(o,r){setTimeout(function(){r(Error(t))},e),n.then(function(e){o(e)},function(e){r(e)})})}},Zousan.resolve=function(e){var t=new Zousan;return t.resolve(e),t},Zousan.reject=function(e){var t=new Zousan;return t.c=[],t.reject(e),t},Zousan.all=function(e){var t=[],n=0,o=new Zousan;function r(r,i){r&&"function"==typeof r.then||(r=Zousan.resolve(r)),r.then(function(r){t[i]=r,++n==e.length&&o.resolve(t)},function(e){o.reject(e)})}for(var i=0;i<e.length;i++)r(e[i],i);return e.length||o.resolve(t),o},Zousan.warn=console.warn,Zousan.soon=soon;export default Zousan;
